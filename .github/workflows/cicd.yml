name: implement a CICD workflow for a Java WebApp using GitHub Actions and Maven
on:
  push:
    branches:
      - main
  workflow_dispatch:
jobs:
 build:
  runs-on: ubuntu-latest
  steps:
  - name: checkout code
    uses: actions/checkout@v3
  - name: Set up JDK 17
    uses: actions/setup-java@v4
    with:
      java-version: '17'
      distribution: 'temurin'
  - name: Build with Maven
    run: mvn install -f MyWebApp/pom.xml
  - name: Run SonarQube Scan
    uses: sonarsource/sonarqube-scan-action@master
    with:
      args: >
        -Dsonar.projectKey=my_key
        -Dsonar.projectName=my_projet
        -Dsonar.java.binaries=target/classes
    env:
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      SONAR_HOST_URL: ${{ secrets.SONAR_HOST_URL }}
  
  - name: Deploy to Tomcat
    run: |
     curl -v -u ${{ secrets.TOMCAT_USER }}:${{ secrets.TOMCAT_PASSWORD }} \
     -T MyWebApp/target/MyWebApp.war \
     "http://${{ secrets.TOMCAT_HOST }}/manager/text/deploy?path=/MyWebApp&update=true"
